
const example = `....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...`;

const input = `.................#.#............................................#................#........................................#.......
.....#.............................................................#.......#...#........................#...........#.......##....
..........................................................#..#........#..........#...............#.#..................#...........
..#...#..........#....#.....#......................................#......#..#............................#..#....................
.........................#....#.............#....................................#............................................#...
.....................#.......#.............#...#..........#.................#.......#...............#............#......#.........
........#.........#.....................................#............#.....................##...#..#..........#...................
....#...................#.....##......#............#...#........................#...................................#.............
...............................................................................#.......#.....#...#................#.#......##.....
..........................................#............................#.#.................................#.........#............
........#...............#...............#...................##......#..................#...............#..........................
.........................#....................................#..........#.........................................##.............
.......#.................#..................................#......#....................#...............#..........#......#.......
.............#.#...#.............#.............................................#...............................##.....#...#.......
.....................................................#............................................#.........................#.....
.#...#..........................................................##.................................#............#...............#.
...........#..#........#.....#.............#.......#............................................#..............#.................#
......#.#.##...............#.......#......#......................................................................#...............#
...#........#.#.....................##...#...........................#..............................#...................#.........
..............#..#....................#...................#.................##..............#.#........................#..........
...........................................................#.........#.......................#......................#.........#...
................................................#............................................#....................................
..#.....................................................#..............#...#.........#.....#........................#.............
.#..............................#......#..............#........................................................#..................
#......#.....#..#..#........#....................#...........##..............................#..#.....#.....#.....................
.................#.....#.....................#.........#..............................#..............##......................#....
...........................................................#...##..............#..........................#....#..................
........#..#............................#.#........................#.....#................#...#...................................
..........................#........#.......................................................................##...................#.
............#....#.............................................#.......#....#.....#........................................#......
..........#............#....#.......................#.#............#..............................................................
......#...#......................................................#..#.............................................................
.#...#.....#.....#......................................................................................#..........#.....#........
...#..#.............................................................................#.............................................
............#...................#...........................................#..............#.....#.....................#.##.......
.................................................#................................................................................
.........................#.......................................#..................#..............................#..............
................................................................................................................................#.
...#...........................................#........#.................................................#......#................
..#...........................................#.......#.....#.................................#....#.............#...............#
........#..............#...................................................................................#......................
...........#......#............#............#..................................#.........#..............#.........#..........#....
.........................#.........#.....#.................................#..................#...............##..#...............
.....#........#.........................................................#....................................#......#....#........
...#..#.......#......#.#..................#..........................^#...........................................................
....................#.#..........................................................................#...#............................
...........................#..........................................................#...........................................
................#..............................................................................#..................................
...............................#............................................................#...................................#.
..............#..........................................#..............#..................#..........#...........................
................#...#..........................#.##..........#.......#..............................#........#..............#.....
...................#.............#....................#...........................................................................
....#....................................#....#................................................#..#...........#...................
....#.#..............#..........#...................#...................................#....................#........#......#....
...........................#...........#..#......#.......................................#.......................#......#.........
.....................................................................................................#.................#..........
...................................................#.............#..........#..............................#......................
................................#...........##....................................................................#....#..........
...........#.......#.......................................................................#............#.....................#...
.#........#.......#........................................#.#...............................#...#...........................#....
..#...............#................#....#............#................................................................#...........
........#..........#.........#....................................................................................#...............
............................................................................#.............................#...............#......#
......................#................................#.............#...#............#...........................................
................................#.............#.................................................................#..............#..
.........#.#..#...............................#....................................................#.#.......#..#........#........
.............................#.......#.....#......................................................#..#............................
..................#.............................................................................#..........#......................
.....................................#....##.................#......................................#....#........................
#.......................................................................................................................#.........
......#....#..#...........................#..#.....#........................................#..................................#..
.......#.....#...............#....#......#....#..........#.....................#....#..........#.....#..#......................##.
..................#..........#.....#........................................................#............##...................#...
........................#....#............#..................................#....#..#.......#...................................#
.....#............................#...............................#..#...................#.....#..#........#....#.#...............
......#...#..#......#..........................#........#....................#.......#...........#..........................#..#..
.....#.............................................................................................#......#......................#
...........................................#......................................................................................
.....#...........................#.#.#............................#..................#............................#.......#.......
........#.......................................................#...................#.......#.....................................
...............#..................................................#.................................................#.............
..##............................................................#..............................................................#..
.......#..................................#......................#.................................#...................#..........
......#.........#..............#....##........#....#................................#.....................................#......#
................#.....................................................................................#.............#.............
#..#..#......#.#.....#..#.................................................................................................#..#....
.....................#.....#................................................#.......#........#.................#........#.#...#...
..................................................................#....#..#...................#................................#..
........................#...........#.......................................................#..#..................................
.#.......#...................................................#..............#.......#...#.........................................
.......##...............#.............................#...........................#...............................................
....#............#....#...#........................#...........................#.#.....#..........................................
...........................#............................#..#..................#...........................#...#...................
...........#.#.............#..........#...........................................................................................
.............#..........#...............#...##.........................#..............#...#.............#..#......................
..................#.....#............#..#.........#...............................................................................
...........................................................#.....#..................#.......................#..#..................
....................................#....#.......##............#.............................#...............#...........#........
......#....................#..................#..........................................#...............................#.#......
......................#...........................................#.....#.................................................#....#..
.....................................#...............#....................................#.....#.............#......##...........
......................#...............................................................##.#..........#....#..................#.....
...........#.............#......................#....................#..................................#......#...........##.....
.....#.#...#......................................................................................................................
.........#.....................................#................#.............#....#......................#..........#............
......##.#.................#...............#..##.......................#...............#.......................................#..
....................#.........#.......#....#..................................#..........................#..............#.........
......................#....#..#..#................................#.......#.......................................................
.........................................##............................##..#..................#..................#...........#....
...................#..................................#................................................................#..........
.#.............#....................................................................................#.............................
......................................#.....#.............#..#............................................#...#............#......
.....................................#..................................#...#.......................##...................#........
...........................................................#...................................................#...........#......
.............................#.......#.......................................#.........................#.....................#...#
.....................#............................................................................................................
#....#.......................................#.........#........#...................................#.....#.........#........#....
.......................................................#......#................................##.#........#.........#..........#.
.........#........................##.....#.............................................................#.................#..#.....
....##....................................................................................................#...#...#...............
.......#.....#.......#.............#........#...............##.#......#...............#.................#..#.........#...#....#...
....................#.................................#........................................................................#..
#...............#....................................#.........#...............................#..#..........##...#...#......#....
............#........................#.....#...#.........#.........#..#......................................#....................
..........#.......#.#.....................#...........#...................#.##....................#..#...#........#..............#
.......................................#.......#........#.....#...........................................#.......#......#........
...............................#.........#..............#......................#..........................................#.#.....
............#........#.............................................#.....................................................##......#
......#.#............................................................................#......#.....#......#................#.......
.........#.............#................#.................#..###..........#.........................#.#....#......................`;

function part1Solution(input, maxIters = 1000) {
	const rotateRight = (input) => _.range(input[0].length).map((i) => input.map(line => line[i]).reverse().join(''));
	const rotateLeft = (input) => _.rangeRight(input[0].length).map((i) => input.map(line => line[i]).join(''));
	let map = rotateRight(input.split('\n'));
	let exited = false;
	let iter = 0;
	while (!exited && ++iter <= maxIters) {
		const y = map.findIndex(x => x.includes('^'));
		const x = map[y].indexOf('^');
		const obsticle = x + map[y].slice(x).indexOf('#');

		if (obsticle < x) { // No obsticle in path, we've exited map
			map[y] = map[y].slice(0,x) + map[y].slice(x).replace(/[.^]/g, 'X');
			exited = true;
		} else { // Obsticle found, go to it
			map[y] = map[y].slice(0,x) + map[y].slice(x,obsticle-1).replace(/[.^]/g, 'X') + '^' + map[y].slice(obsticle);
		}

		map = rotateLeft(map);
	}
	return map.join('').match(/X/g).length;
}

console.log(part1Solution(example)); // 41
console.log(part1Solution(input)); // 4973

// I ended up switching to rust for part 2, and rewrote part 1 in rust too.
